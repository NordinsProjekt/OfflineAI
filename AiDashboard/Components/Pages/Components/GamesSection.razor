@using Application.AI.Utilities
@inject GameDetector GameDetector
@inject NavigationManager Navigation

<section class="oa-card">
    <div class="oa-card-title">?? Games</div>
    
    @if (gameCount > 0)
    {
        <div class="oa-info-text" style="margin-bottom: 1rem;">
            <strong>@gameCount</strong> game(s) registered
        </div>
        
        @if (recentGames.Any())
        {
            <div class="recent-games">
                @foreach (var game in recentGames.Take(3))
                {
                    <div class="game-tag">@game.DisplayName</div>
                }
                @if (gameCount > 3)
                {
                    <div class="game-tag more">+@(gameCount - 3) more</div>
                }
            </div>
        }
    }
    else
    {
        <div class="oa-info-text">
            No games registered yet
        </div>
    }
    
    <button class="oa-btn oa-btn-block" @onclick="GoToGameManagement">
        Manage Games
    </button>
</section>

@code {
    private int gameCount = 0;
    private List<(string GameId, string DisplayName)> recentGames = new();

    protected override async Task OnInitializedAsync()
    {
        try
        {
            recentGames = await GameDetector.GetAllGamesAsync();
            gameCount = recentGames.Count;
        }
        catch
        {
            gameCount = 0;
            recentGames = new();
        }
    }

    private void GoToGameManagement()
    {
        Navigation.NavigateTo("/games");
    }
}
