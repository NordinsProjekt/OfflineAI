@inject DashboardState Dashboard
@inject IJSRuntime JSRuntime

<CollapsibleSection SectionKey="table" Title="Table Management">
    <div class="oa-field">
        <label>Active Table</label>
        <input type="text" class="oa-text" @bind="Dashboard.ActiveTable">
    </div>
    <div class="oa-grid2">
        <button class="oa-btn" @onclick="async () => await Dashboard.ListTablesAsync()">List</button>
        <button class="oa-btn" @onclick="async () => await Dashboard.InfoTableAsync()">Info</button>
    </div>
    <div class="oa-grid2">
        <button class="oa-btn" @onclick="async () => await Dashboard.CreateTableAsync()">Create</button>
        <button class="oa-btn" @onclick="async () => await Dashboard.SwitchTableAsync()">Switch</button>
    </div>
    
    @if (!confirmingDelete)
    {
        <button class="oa-btn oa-btn-danger oa-btn-block" @onclick="ShowDeleteConfirmation">Delete</button>
    }
    else
    {
        <div class="delete-confirmation">
            <div class="confirmation-warning">
                ? Are you sure you want to delete table '<strong>@Dashboard.ActiveTable</strong>'?
                <br/>
                <small>This action cannot be undone and all data will be lost.</small>
            </div>
            <div class="oa-grid2">
                <button class="oa-btn" @onclick="CancelDelete">Cancel</button>
                <button class="oa-btn oa-btn-danger" @onclick="ConfirmDelete">Confirm Delete</button>
            </div>
        </div>
    }
</CollapsibleSection>

@code {
    private bool confirmingDelete = false;

    private void ShowDeleteConfirmation()
    {
        confirmingDelete = true;
    }

    private void CancelDelete()
    {
        confirmingDelete = false;
    }

    private async Task ConfirmDelete()
    {
        // Double confirmation using JavaScript confirm dialog
        bool finalConfirm = await JSRuntime.InvokeAsync<bool>(
            "confirm", 
            $"FINAL CONFIRMATION: Delete table '{Dashboard.ActiveTable}'?\n\nThis will permanently delete all data in this table.");
        
        if (finalConfirm)
        {
            await Dashboard.DeleteTableAsync();
        }
        
        confirmingDelete = false;
    }
}
