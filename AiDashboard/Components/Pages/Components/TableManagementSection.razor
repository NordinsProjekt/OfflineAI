@inject DashboardService DashboardService
@inject IJSRuntime JSRuntime

<section class="oa-card">
    <div class="oa-card-title">Table Management</div>
    
    <div class="oa-field">
        <label>Active Table</label>
        <input type="text" class="oa-text" @bind="DashboardService.ActiveTable">
    </div>
    <div class="oa-grid2">
        <button class="oa-btn" @onclick="async () => await DashboardService.ListTablesAsync()">List</button>
        <button class="oa-btn" @onclick="async () => await DashboardService.InfoTableAsync()">Info</button>
    </div>
    <div class="oa-grid2">
        <button class="oa-btn" @onclick="async () => await DashboardService.CreateTableAsync()">Create</button>
        <button class="oa-btn" @onclick="async () => await DashboardService.SwitchTableAsync()">Switch</button>
    </div>
    
    @if (!confirmingDelete)
    {
        <button class="oa-btn oa-btn-danger oa-btn-block" @onclick="ShowDeleteConfirmation">Delete</button>
    }
    else
    {
        <div class="delete-confirmation">
            <div class="confirmation-warning">
                ?? Are you sure you want to delete table '<strong>@DashboardService.ActiveTable</strong>'?
                <br/>
                <small>This action cannot be undone and all data will be lost.</small>
            </div>
            <div class="oa-grid2">
                <button class="oa-btn" @onclick="CancelDelete">Cancel</button>
                <button class="oa-btn oa-btn-danger" @onclick="ConfirmDelete">Confirm Delete</button>
            </div>
        </div>
    }
</section>

@code {
    private bool confirmingDelete = false;

    private void ShowDeleteConfirmation()
    {
        confirmingDelete = true;
    }

    private void CancelDelete()
    {
        confirmingDelete = false;
    }

    private async Task ConfirmDelete()
    {
        // Double confirmation using JavaScript confirm dialog
        bool finalConfirm = await JSRuntime.InvokeAsync<bool>(
            "confirm", 
            $"FINAL CONFIRMATION: Delete table '{DashboardService.ActiveTable}'?\n\nThis will permanently delete all data in this table.");
        
        if (finalConfirm)
        {
            await DashboardService.DeleteTableAsync();
        }
        
        confirmingDelete = false;
    }
}
