@inject DashboardState Dashboard
@implements IDisposable

<div class="active-context-bar">
    <div class="context-item">
        <span class="context-label">Bot:</span>
        @if (Dashboard.PersonalityService?.CurrentPersonality != null)
        {
            var personality = Dashboard.PersonalityService.CurrentPersonality;
            <span class="context-value personality-badge">
                @if (!string.IsNullOrWhiteSpace(personality.Icon))
                {
                    <span class="badge-icon">@personality.Icon</span>
                }
                <span class="badge-text">@personality.DisplayName</span>
            </span>
        }
        else
        {
            <span class="context-value default">General Assistant</span>
        }
    </div>
    
    <div class="context-divider">|</div>
    
    <div class="context-item">
        <span class="context-label">Collection:</span>
        @if (Dashboard.CollectionService?.CurrentCollection != null)
        {
            <span class="context-value collection-badge">@Dashboard.CollectionService.CurrentCollection
            </span>
        }
        else
        {
            <span class="context-value default">None</span>
        }
    </div>
</div>

<style>
    .active-context-bar {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 8px 15px;
        background: rgba(0, 0, 0, 0.3);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        font-size: 0.9em;
    }
    
    .context-item {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .context-label {
        color: rgba(255, 255, 255, 0.5);
        font-size: 0.85em;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .context-value {
        color: rgba(255, 255, 255, 0.9);
    }
    
    .context-value.default {
        color: rgba(255, 255, 255, 0.5);
        font-style: italic;
    }
    
    .personality-badge, .collection-badge {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        padding: 4px 10px;
        background: rgba(13, 110, 253, 0.2);
        border: 1px solid rgba(13, 110, 253, 0.4);
        border-radius: 12px;
        font-weight: 500;
    }
    
    .collection-badge {
        background: rgba(25, 135, 84, 0.2);
        border-color: rgba(25, 135, 84, 0.4);
    }
    
    .badge-icon {
        font-size: 1.1em;
    }
    
    .context-badge {
        padding: 4px 10px;
        background: rgba(255, 193, 7, 0.2);
        border: 1px solid rgba(255, 193, 7, 0.4);
        border-radius: 12px;
        color: #ffc107;
        font-weight: 500;
    }
    
    .context-divider {
        color: rgba(255, 255, 255, 0.2);
        font-size: 0.8em;
    }
</style>

@code {
    protected override void OnInitialized()
    {
        Dashboard.OnChange += HandleStateChanged;
    }

    private void HandleStateChanged()
    {
        _ = InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        Dashboard.OnChange -= HandleStateChanged;
    }
}
